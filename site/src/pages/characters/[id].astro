---
import Layout from "../../layouts/Layout.astro";
import { loadAllCharacters, loadAllScenes } from "../../utils/yaml-loader.js";

export function getStaticPaths() {
    const characters = loadAllCharacters();
    return characters.map((character) => ({
        params: { id: character.id },
        props: { character },
    }));
}

const { character } = Astro.props;
const allScenes = loadAllScenes();
const characterScenes = allScenes.filter(
    (scene) => scene.characters && scene.characters.includes(character.id),
);
---

<Layout title={character.name}>
    <h1>{character.name}</h1>
    <p class="meta">{character.role}</p>

    <section>
        <h2>Description</h2>
        <p>{character.description}</p>
    </section>

    <section>
        <h2>Appearances</h2>
        {
            characterScenes.length > 0 ? (
                <ul>
                    {characterScenes.map((scene) => (
                        <li>
                            <a href={`/scenes/${scene.id}`}>{scene.title}</a>
                            <span> - Episode {scene.episode}</span>
                        </li>
                    ))}
                </ul>
            ) : (
                <p>No scenes found for this character.</p>
            )
        }
    </section>

    {
        character.relationships &&
        Array.isArray(character.relationships) &&
        character.relationships.length > 0 ? (
            <section>
                <h2>Relationships</h2>
                <ul>
                    {character.relationships.map((rel) => (
                        <li>
                            <strong>{rel.type}:</strong> {rel.target}
                        </li>
                    ))}
                </ul>
            </section>
        ) : null
    }

    <style>
        .meta {
            color: #666;
            font-style: italic;
            font-size: 1.2em;
        }
    </style>
</Layout>
